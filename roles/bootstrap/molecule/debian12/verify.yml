---
- name: Verify
  hosts: ansiblinux_debian_12
  become: true
  tasks:
    - name: Var files load
      block:
        - name: Include specific testing vars
          ansible.builtin.include_vars: vars.yml

        - name: Include role vars
          ansible.builtin.include_vars:
            dir: ../../defaults/main

    - name: (DEBIAN) Check if main APT repo config is present
      ansible.builtin.apt_repository:
        repo: '{{ item }}'
        state: present
      loop:
        - '{{ repo_content }}'
      register: apt_repo_test
      failed_when: apt_repo_test is changed

    - name: (DEBIAN) Check if zram-generator config file is present
      ansible.builtin.stat:
        path: '{{ zram_configfile }}'

    - name: (DEBIAN) Check if some binaries are present
      ansible.builtin.stat:
        path: '{{ item }}'
      loop:
        - '{{ bin_testing }}'

    - name: (DEBIAN) Check if swappiness value is set to {{ swappiness_value }}
      ansible.builtin.lineinfile:
        path: /etc/sysctl.conf
        regexp: 'vm.swappiness={{ swappiness_value }}'
        state: present
      register: sysctl_swappiness_test
      failed_when: sysctl_swappiness_test is changed
